<div class="d-flex justify-content-between align-items-center my-4">
  <h1><%= t(".title", id: @model_response.id) %></h1>
  <%= link_to t(".back_to_model_responses"), raif.admin_model_responses_path, class: "btn btn-outline-secondary" %>
</div>

<div class="card mb-4">
  <div class="card-header">
    <h5 class="mb-0"><%= t("raif.admin.common.details") %></h5>
  </div>
  <div class="card-body">
    <div class="row mb-3">
      <div class="col-md-3"><strong><%= t("raif.admin.common.id") %>:</strong></div>
      <div class="col-md-9"><%= @model_response.id %></div>
    </div>
    <div class="row mb-3">
      <div class="col-md-3"><strong><%= t("raif.admin.common.source") %>:</strong></div>
      <div class="col-md-9"><%= @model_response.source_type %> #<%= @model_response.source_id %></div>
    </div>
    <div class="row mb-3">
      <div class="col-md-3"><strong><%= t("raif.admin.common.model") %>:</strong></div>
      <div class="col-md-9"><%= @model_response.llm_model_key %></div>
    </div>
    <div class="row mb-3">
      <div class="col-md-3"><strong><%= t("raif.admin.common.response_format") %>:</strong></div>
      <div class="col-md-9"><%= @model_response.response_format %></div>
    </div>
    <div class="row mb-3">
      <div class="col-md-3"><strong><%= t("raif.admin.common.created_at") %>:</strong></div>
      <div class="col-md-9"><%= @model_response.created_at.strftime("%Y-%m-%d %H:%M:%S") %></div>
    </div>
    <div class="row mb-3">
      <div class="col-md-3"><strong><%= t("raif.admin.common.prompt_tokens") %>:</strong></div>
      <div class="col-md-9"><%= @model_response.prompt_tokens ? number_with_delimiter(@model_response.prompt_tokens) : "-" %></div>
    </div>
    <div class="row mb-3">
      <div class="col-md-3"><strong><%= t("raif.admin.common.completion_tokens") %>:</strong></div>
      <div class="col-md-9"><%= @model_response.completion_tokens ? number_with_delimiter(@model_response.completion_tokens) : "-" %></div>
    </div>
    <div class="row mb-3">
      <div class="col-md-3"><strong><%= t("raif.admin.common.total_tokens") %>:</strong></div>
      <div class="col-md-9"><%= @model_response.total_tokens ? number_with_delimiter(@model_response.total_tokens) : "-" %></div>
    </div>
  </div>
</div>

<div class="card mb-4">
  <div class="card-header">
    <h5 class="mb-0"><%= t("raif.admin.common.response") %> (<%= @model_response.response_format %>)</h5>
  </div>
  <div class="card-body">
    <% if @model_response.response_format_json? %>
      <h5 class="mb-0"><%= t("raif.admin.common.raw") %></h5>
      <pre class="pre-wrap"><%= @model_response.raw_response %></pre>

      <h5 class="mb-0 mt-4"><%= t("raif.admin.common.prettified") %></h5>
      <% begin %>
        <pre class="pre-wrap"><%= JSON.pretty_generate(@model_response.parsed_response) %></pre>
      <% rescue StandardError %>
        <%= t("raif.admin.common.invalid_json") %>
      <% end %>
    <% elsif @model_response.response_format_html? %>
      <h5 class="mb-0"><%= t("raif.admin.common.raw") %></h5>
      <pre class="pre-wrap"><%= @model_response.raw_response %></pre>

      <h5 class="mb-0 mt-4"><%= t("raif.admin.common.rendered") %></h5>
      <div class="border p-3 bg-light">
        <%= sanitize @model_response.parsed_response %>
      </div>
    <% else %>
      <pre class="pre-wrap"><%= @model_response.raw_response %></pre>
    <% end %>
  </div>
</div> 